SELECT id, stra_no, sub_no, min_cenghou = CASE WHEN isLastCeng = 0 THEN '' ELSE  MIN(CengHou) END, MAX(CengHou) as max_cenghou, AVG(CengHou) as avg_cenghou, MIN(cengdi) AS min_CengDi, MAX(cengdi) AS max_CengDi, MIN(cengding) AS min_CengDing, MAX(cengding) AS max_CengDing, MIN(Cengshen) as min_cengshen, MAX(Cengshen) as max_cengshen FROM (SELECT stratum_description.id,Stratum.drl_no, drills.drl_elev, Stratum.stra_no, Stratum.sub_no, Stratum.stra_cenghou as CengHou, Stratum.stra_depth as cengshen,  drills.drl_elev - Stratum.stra_depth as cengdi, drills.drl_elev - Stratum.stra_depth + Stratum.stra_cenghou as cengding FROM Stratum INNER JOIN drills  ON Stratum.prj_no = drills.prj_no AND Stratum.drl_no = drills.drl_no  INNER JOIN stratum_description  ON Stratum.prj_no = stratum_description.prj_no  AND Stratum.stra_no = stratum_description.stra_no AND Stratum.sub_no = stratum_description.sub_no WHERE (Stratum.prj_no = '2011-K-107')  AND (Stratum.stra_cenghou>0) AND Stratum.drl_no in (select drl_no from drills where can_tongji=0  AND prj_no='2011-K-107') ) newtable GROUP BY id, stra_no, sub_no ORDER BY id